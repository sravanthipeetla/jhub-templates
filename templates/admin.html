{% extends "templates/page.html" %}
{% block stylesheet %}
{{ super() }}
<style>
  @import url('https://fonts.googleapis.com/css2?family=Gothic+A1:wght@400;500;600&family=Poppins:wght@500;600&display=swap');
*{
    box-sizing: border-box;
}

body {
    margin: 0px;
    padding:0px;
  }
.stop-visible{
    display:none;
}
.admin-container {
    margin-left: 10vw;
    margin-right: 10vw;
    overflow: auto;
    position: relative;
}

.admin-navbar {
    overflow: hidden;  
    margin: 3.5vh 0;
}

.admin-navbar a {
    float: left;
    color: #000000;
    text-align: center;
    padding: 1vw 4vw;
    text-decoration: none;
    font-size: 1rem;
    border-bottom: 0.3vw solid #DBDBDB;
    overflow: auto;
    font-weight:500;
    font-family:'Poppins';
}

.admin-navbar a:hover {
    cursor: pointer;
}

.admin-navbar a.active {
    border-bottom: 0.3vw solid #006BB6;
    color: #006BB6;
}

.description-bar {
    border-bottom:2px solid #DBDBDB;
    display:flex;
    justify-content: space-between;
    padding-bottom: 2vh;
    margin-bottom: 3vh;
}

.description {
    font-family: 'Poppins';
    color:#4D4D4D;
    font-weight:500;
    font-size: 1rem;
}
#right-description-bar select{
    border-radius:50px;
    height:2.5rem;
    width:13.75rem;
    border:1px solid #5FBEF0;
    padding: 0rem 1rem;
    font-size: 1rem;
    font-weight: 0;
    color: black;
    outline: none;
}
#right-description-bar input{
    border: none;
    outline: none;
    width:10rem;
    margin-left:1rem;
}
#right-description-bar input::placeholder {
    color: #ccc;
}

#right-description-bar {
    display: flex;
    gap: 1rem;
}
.searchIcon{
    overflow: hidden;
    width: 40px;
    padding: 0;
    margin: 0;
    border: 1px solid transparent;
    border-radius: inherit;
    background: transparent url("https://i.postimg.cc/RC7FPYL5/search.png") no-repeat center;
    cursor: pointer;
    opacity: 0.7;
}
#right-description-bar form {
    color: #555;
    display: flex;
    justify-content: space-between;
    border: 2px solid blue;
    border-radius: 5px;
    border-radius:50px;
    height:2.5rem;
    width:13.75rem;
    border:1px solid #5FBEF0;
    font-size: 1rem;
    font-weight: 0;
    color: black;
}
.add-btn {
    border:none;
    font-family: 'Poppins';
    background-color: #5FBEF0;
    border-radius: 21px;
    color: white;
    font-weight: 500;
    font-size: 1rem;
    height:2.5rem;
    display: inline-block;
    padding: 0px 1rem;
    text-align: center;
    cursor: pointer;
} 
.courseDetails, .trainerDetails{
    display: flex;
    flex-wrap: wrap; 
}

.courseCard,.trainerCard{
    display: flex;
    justify-content: space-between;
    background: linear-gradient(108.02deg, rgba(246, 251, 254, 0) 64.53%, #D6F0FF 122.73%), linear-gradient(179.46deg, rgba(246, 251, 254, 0) 1.56%, #DBF2FF 127.02%);
    border-radius: 10px;
    margin-right: 1%;
    margin-left: 1%;
    margin-bottom: 1.5vh;
    width:23%;
}
.trainerCard-width{
    width: 18%;
}

.course-card-left,.trainer-card-left{
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    padding: 0rem 0.75rem 1rem;
    font-family: 'Gothic A1';
    width: 100%;
}
.course-title,.trainer-title{
    color:#006BB6;
    font-weight: 600;
    font-size: 1rem;
}
.learner-count-title{
    color:#999;
    font-weight: 400;
    font-size: 0.75rem;
}
.learner-count{
    font-weight: 500;
    font-size: 0.875rem;
}
.arrange-row{
    display: flex;
}
.arrange-col{
    display: flex;
    flex-direction: column;
    justify-content: end;
}
.arrange-col-first{
    width:35%;
}
.delete-icon img{
    width:1rem;
}
.eye-icon{
    display: flex;
    flex-direction: column;
    justify-content: end;
    align-items: center;
    background: linear-gradient(180deg, rgba(230, 244, 255, 0) -6.12%, #C2E6FF 106.76%);
    border-radius: 0px 10px 10px 0px;
    padding: 0.5rem;
    cursor: pointer;
}

#learner-table {
    margin-bottom: 20px;
    background: #FFFFFF;
    /* border: 2px solid #5FBEF0; */
    border-collapse: inherit;
    border-spacing: 0px;
    border-radius: 14px 14px 0px 0px;
    table-layout: fixed;
    overflow: hidden;
    width: 100%;
    border: 1px solid #C6E7FB;
}

#learner-thead {
    background: #D2EDFB;;
    border-collapse: inherit;
    border-radius: 12px 12px 0px 0px; 
}
tbody tr td:last-child{
    text-align: right;
    padding: 0.5rem 3rem;
}
tbody tr td:first-child{
    padding: 0.5rem 1.5rem; 
}
tr th:first-child{
    text-align: left;
    width:80%;
}
tr th:last-child{
    text-align: right;
}
tr th:nth-child(2){
    text-align: center;
}
tbody tr:nth-child(even) {
    background-color:#FAFDFF;
  }
tbody tr:nth-child(odd) {
    background-color: #F1F9FE;;
  }

  tr td:nth-child(2){
    text-align: center;
    
}

th{
    font-family: 'Poppins';
    font-style: normal;
    font-weight: 500;
    font-size: 1rem;
    color:#006BB6;
    padding: 0.5rem 1.5rem;
}
.bg-model{
    /* display: none; */
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1;
    background-color: rgba(0,0,0, .2);
}
.course-model{
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    background:#FFFFFF;
    box-shadow: 0px 2px 13px rgba(170, 170, 170, 0.27);
    border-radius: 16px;
    width:30rem;
    height:14rem;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: animatemodal .3s;
}
@keyframes animatemodal {
    0% {
        top: -300px;
        opacity: 0;
    }

    100% {
        top: -50%;
        opacity: 1;
    }
}
.delete-icon{
    display: flex;
    flex-direction: column;
    justify-content: end;
    align-items: center;
    background: linear-gradient(180deg, rgba(254, 245, 245, 0.2) -6.12%, #FCEAE8 106.76%);
    border-radius: 0px 10px 10px 0px;
    padding: 0.5rem;
    cursor: pointer;
}

.delete-course-model-top-first{
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #FEEBEC;
    box-shadow: 0px 3px 5px rgba(0, 0, 0, 0.08);
    border-radius: 12px 12px 0px 0px;
    padding: 0.25rem 1rem;
}

.delete-course-model-top-first h1{
    font-family: 'Poppins';
    font-style: normal;
    font-weight: 600;
    font-size: 1rem;
    color: #F63C46;
}
.delete-course-model-top-first span{
    font-size: 1.8rem;
    color: #F7545D;
    font-weight: 500;
    background: #FDCED1;
    border-radius: 50%;
    cursor: pointer;
    height: 0.5rem;
    width: 0.5rem;
    padding: 0rem 0.4rem;
}
.delete-title{
    font-size: 1rem;
    text-align: center;
    font-family: 'Gothic A1';
    font-style: Medium;
    font-weight: 500;
}

.delete-course-model-bottom{
    text-align: center;
}
.delete-course-model-bottom p{
    color: #AAAAAA;
    font-family: 'Poppins';
    font-style: normal;
    font-weight: 400;
    font-size: 0.875rem;
    margin-top:1rem;
}

.delete-button{
    border:none;
    background: #F7545D;
    border-radius: 14px;
    font-family: 'Poppins';
    font-style: normal;
    font-weight: 400;
    font-size: 0.75rem;
    text-align: center;
    color: #FFFFFF;
    height:1.75rem;
    width: 5rem;
}

.cancel-button{
background: #FFFFFF;
border: 1px solid #5FBEF0;
border-radius:  14px;
/* padding: 0.5rem 1rem; */
font-family: 'Poppins';
font-style: normal;
font-weight: 400;
font-size: 0.75rem;
color: #5FBEF0;
height:1.75rem;
width: 5rem;
}

.add-course-model-height,.add-learner-model-height{
    height:18rem;
}
.add-course-model-top-first,.add-learner-model-top-first{
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem 1rem;
    border-radius: 12px 12px 0px 0px;
    background: #F6FBFE;
    box-shadow: 0px 3px 5px rgba(0, 0, 0, 0.08);
    border-radius: 12px 12px 0px 0px;
}

.add-course-model-top-first h1,.add-learner-model-top-first h1{
    font-family: 'Poppins';
    font-style: normal;
    font-weight: 600;
    font-size: 1rem;
    color: #5FBEF0;
}
.add-course-model-top-first span,.add-learner-model-top-first span{
    font-size: 2rem;
    color: #5FBEF0;
    font-weight: bold;
    background: #E8F6FD;
    border-radius: 50%;
    cursor: pointer;
    height: 1rem;
    width: 1rem;
    padding: 0 0.5rem;
}
.add-course-name,.choose-trainer-name,.add-learner{
    padding: 1rem;
    display: flex;
    align-items: center;
}
.add-course-name p{
    font-family: 'Gothic A1';
    font-style: normal;
    font-weight: 400;
    font-size: 1rem;
    color: #000000;
    width:8rem;

}
.add-course-name input,.choose-trainer-name select,.add-learner input{
    border-radius:50px;
    height:2rem;
    border:1px solid #5FBEF0;
    padding: 0rem 1rem;
    font-size: 0.875rem;
    font-weight: 0;
    width:20rem;
    color: #A6A6A6;
}
.add-course-name input::placeholder{
    font-size: 0.875rem;
    font-family: 'Poppins';
    font-style: normal;
    font-weight: 400;
    color: #A6A6A6;
}
.choose-trainer-arrange,.choose-learner-arrange{
    display: flex;
    flex-direction: column;
}
.choose-trainer-arrange p{
    margin-top: -0.3rem;
    font-family: 'Gothic A1';
    font-style: normal;
    font-weight: 400;
    font-size: 1rem;
    color: #000000;
    width:8rem;
   
    }
.choose-trainer-arrange span{
   
font-family: 'Gothic A1';
font-style: normal;
font-weight: 400;
font-size: 0.875rem;
color: #A6A6A6;
margin-top: -0.8rem;
width:8rem;
}
.add-course-model-bottom{
    text-align: center;
    background: #FFFFFF;
    box-shadow: 0px 2px 13px rgba(170, 170, 170, 0.27);
    border-top: 1px solid #DBDBDB;
    border-bottom-left-radius: 12px;
    border-bottom-right-radius: 12px;
    padding: 1.5rem;
}
.add-button{
    border:none;
    background: #5FBEF0;
    border-radius:  14px;
    font-family: 'Poppins';
    font-style: normal;
    font-weight: 400;
    font-size: 0.75rem;
    text-align: center;
    color: #FFFFFF;
    height:1.75rem;
    width: 5rem;
}
.trainer-model{
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    background:#FFFFFF;
    box-shadow: 0px 2px 13px rgba(170, 170, 170, 0.27);
    border-radius: 1rem;
    width:50rem;
    height:32rem;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: animatemodal .3s;
}
.delete-trainer-model-top-first{
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem 1rem;
    border-radius: 0.75rem 0.75rem 0px 0px;
    background: #F6FBFE;
    box-shadow: 0px 3px 5px rgba(0, 0, 0, 0.08);
}
.delete-trainer-title{
    font-family: 'Poppins';
    font-style: normal;
    font-weight: 600;
    font-size: 1rem;
    color: #999999;
}
.delete-trainer-name{
color: #006BB6;
}
#deleteTrainerCancel{
    font-size: 2rem;
    text-align: center;
    color: #006BB6;
    font-weight: bold;
    background: #D2EDFB;
    border-radius: 50%;
    cursor: pointer;
    height: 1rem;
    width: 1rem;
    padding: 0 0.5rem;
}
.change-learner{
    padding: 2rem;
}
.learner-inactive{
    font-size: 0.8rem;
    border-radius: 1rem;
    padding: 0.5rem 2rem;
    border: 1px solid #DBDBDB;
    background: #FFFFFF;
    color: #DBDBDB;
    cursor: pointer;
}
.learner-active{
    color: #5FBEF0;
    border: 1px solid #5FBEF0;
}
.upload-btn{
    border-radius:50px;
    height:2rem;
    border:1px dashed #5FBEF0;
    padding: 0rem 1rem;
    font-size: 0.875rem;
    font-weight: 0;
    width:10rem;
    color: #A6A6A6;
    text-align: center;
}

@media(max-width:1600px){
    html{
        font-size: 100%;
    } 
    .courseCard{
        width: 31%;
    }
    .trainerCard{
        width: 23%;
    }
}

@media(max-width:1200px){
    html{
        font-size: 87.5%;
    }

}

@media(max-width:1000px){
    html{
        font-size: 75%;
    }

}



</style>
{% endblock %}
{% block main %}
<div id="react-admin-hook">
  <script id="jupyterhub-admin-config">
    window.api_page_limit = parseInt("{{ api_page_limit|safe }}")
    window.base_url = "{{ base_url|safe }}"
  </script>
  <script src={{ static_url("js/admin.js") }}></script>
  <div>
    <div class="admin-container">
        <div class="admin-navbar">
                <a class="course-nav active" id="course-nav">Courses</a>
                <a class="instructor-nav" id="instructor-nav">Trainers</a>
                <a class="learner-nav" id="learner-nav">Learners</a>
        </div>
        <div class="description-bar">
                <p class="description" id="description">You can manage Course details here.</p>
                <div id="right-description-bar" >
                    <form>
                        <input type="search" value="" placeholder="Search...">
                        <button class="searchIcon" type="submit"></button>
                    </form>
                   
                    <select  id="instructors_filter" class="stop-visible">
                        <option default  value="all">All</option>
                        <option value="mapped">Mapped</option>
                        <option value="unmapped">Unmapped</option>
                    </select>
                    <button class="add-btn" id="add-btn">Add Course</button>
                </div>
        </div>
        <div id="courseDetails">
            <div class="courseDetails" id="courseCardCont">
            </div>
        </div>
        <div id="trainerDetails" class="stop-visible">
            <div class="trainerDetails" id="trainerCardCont">
            </div>
        </div>
        <div id="learnerDetails" class="stop-visible">
            <table id="learner-table">
                <tr id="learner-thead">
                    <th>Learners Name</th>
                    <th>Actions</th>
                    <th>Remove</th>
                </tr>
                <tbody>
                    <tr>
                        <td>Sravanthi Peetla</td>
                        <td><img src="https://i.postimg.cc/KzLzhpXT/eye.png" alt=""></td>
                        <td><img src="https://i.postimg.cc/prKj8HZB/delete.png" alt=""></td>
                    </tr>
                    <tr>
                        <td>Sravanthi Peetla</td>
                        <td><img src="https://i.postimg.cc/KzLzhpXT/eye.png" alt=""></td>
                        <td><img src="https://i.postimg.cc/prKj8HZB/delete.png" alt=""></td>
                    </tr>
                    <tr>
                        <td>Sravanthi Peetla</td>
                        <td><img src="https://i.postimg.cc/KzLzhpXT/eye.png" alt=""></td>
                        <td><img src="https://i.postimg.cc/prKj8HZB/delete.png" alt=""></td>
                    </tr>
                    <tr>
                        <td>Sravanthi Peetla</td>
                        <td><img src="https://i.postimg.cc/KzLzhpXT/eye.png" alt=""></td>
                        <td><img src="https://i.postimg.cc/prKj8HZB/delete.png" alt=""></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div class="bg-model" id="deleteCourseModal">
        <div class="course-model">
            <div>
                <div class="delete-course-model-top-first">
                    <h1>Delete Course</h1>
                    <div id="deleteCancel">
                        <span> &times;</span>
                    </div>
                </div>
                    <h1 class="delete-title" >Delete <span id="deleteTitle"></span>?</h1>
            </div>
                <div class="delete-course-model-bottom">
                    <button id="delete-button" class="delete-button">Delete</button>
                    <button id="cancel-button" class="cancel-button">Cancel</button>
                    <p>once deleted can't be restore again</p>  
                </div>  
        </div>
       
    </div>
    <div class="bg-model" id="addCourseModal">
        <div class="course-model add-course-model-height">
            <div>
                <div class="add-course-model-top-first">
                    <h1 id="modelTitle">Add Course</h1>
                    <div id="addCourseCancel">
                        <span> &times;</span>
                    </div>
                </div>
                    <div class="add-course-name">
                        <p>Course Name</p>
                        <input type="text" placeholder="Enter course name">
                    </div>
                    <div class="choose-trainer-name">
                        <div class="choose-trainer-arrange">
                            <p>Choose Trainer</p>
                            <span>Existing Trainer</span>
                        </div> 
                        <select placeholder="Enter course name">
                            <option default  value="" class="choose-trainer-option">Choose trainer</option>
                        </select>
                    </div>
            </div>
                <div class="add-course-model-bottom">
                    <button id="delete-button" class="add-button">Add</button>
                    <button id="cancel-button" class="cancel-button">Cancel</button>
                </div>  
        </div>
       
    </div>
    <div class="bg-model" id="deleteTrainerModal">
        <div class="trainer-model">
            <div>
                <div class="delete-trainer-model-top-first">
                    <h1 class="delete-trainer-title">Trainer-<span class="delete-trainer-name" id="deleteTrainer"></span></h1>
                    <div >
                        <span id="deleteTrainerCancel">&times;</span>
                    </div>
                </div>
            </div> 
        </div>
    </div>
    <div class="bg-model" id="addLearnerModal">
        <div class="course-model add-learner-model-height">
            <div>
                <div class="add-learner-model-top-first">
                    <h1>Add Learners</h1>
                    <div id="addLearnerCancel">
                        <span> &times;</span>
                    </div>
                </div>
                    <div class="change-learner">
                        <button id="singleUser" class="learner-inactive learner-active">Single User</button>
                        <button id="multipleUser" class="learner-inactive">Bulk Users</button>
                    </div>
                    <div id="singleLearner">
                        <div class="add-learner">
                            <div class="choose-trainer-arrange">
                                <p>User ID</p>
                                <span>Single learner</span>
                            </div> 
                            <input type="text" placeholder="Enter user ID">
                        </div>
                    </div>
                    <div id="multipleLearners" class="stop-visible">
                        <div class="add-learner">
                            <div class="choose-trainer-arrange">
                                <p>Upload CSV file</p>
                                <span>Multiple learners</span>
                            </div> 
                            <button class="upload-btn"><img src="https://i.postimg.cc/7Z71QKgW/Vector-4.png" alt=""></button>
                        </div>
                    </div>
            </div>
                <div class="add-course-model-bottom">
                    <button id="delete-button" class="add-button">Add</button>
                    <button id="cancel-button" class="cancel-button">Cancel</button>
                </div>  
        </div>
    </div>
</div>
</div>
{% endblock %}

{% block footer %}
{% endblock %}

{% block script %}
{{ super() }}
<script type="text/javascript">
  // require(["admin"]);

  // custom script

  // url for hub and ngshare

  const hub_url = `/api/`;
  const ngshare_url = `/services/ngshare/`;

  // To change the color for active link in top left navbar items
  const currentUrl = window.location.pathname.split('/');
  const currentAnchorTagText = currentUrl[currentUrl.length - 1];
  $('.navbar-nav a').each(function () {
    if ($(this).text().toLowerCase() == currentAnchorTagText) {
      $(this).css('color', '#006BB6');
    }
  });

//   // To hide left navbar items - 'Token' and 'services'
//   const navbarLeftList = document.getElementsByClassName('nav navbar-nav')[0].getElementsByTagName('li');
//   navbarLeftList[1].style.display = 'none';
//   navbarLeftList[3].style.display = 'none';

let instructor = document.getElementById('instructor-nav');
let courses = document.getElementById('course-nav');
let learner = document.getElementById('learner-nav');
let addBtn = document.getElementById('add-btn');
let courseDetails = document.getElementById('courseDetails');
let description = document.getElementById('description');
let req = document.getElementById('req');
let courseCard = document.getElementById('courseCard');
let trainerDetails = document.getElementById('trainerDetails');
let instructorsFilter = document.getElementById('instructors_filter');
let learnerDetails = document.getElementById('learnerDetails');
let deleteIcon = document.getElementById('delete-icon');
let deleteCourseModal = document.getElementById('deleteCourseModal');
let deleteCancel = document.getElementById('deleteCancel');
let addLearnerModal = document.getElementById('addLearnerModal');
let addCourseCancel = document.getElementById('addCourseCancel');
let courseCardCont = document.getElementById('courseCardCont');
let trainerCardCont = document.getElementById('trainerCardCont');
let trainerEyeIcon = document.getElementById('trainer-eye-icon');
let deleteTrainerModal = document.getElementById('deleteTrainerModal');
let deleteTrainer = document.getElementById('deleteTrainer');
let deleteTrainerCancel = document.getElementById('deleteTrainerCancel');
let addLearnerCancel = document.getElementById('addLearnerCancel');
let singleUserBtn = document.getElementById('singleUser');
let multipleUserBtn = document.getElementById('multipleUser');
let singleLearner = document.getElementById('singleLearner');
let multipleLearners = document.getElementById('multipleLearners');
let modelTitle = document.getElementById('modelTitle');
let deleteBtn = document.getElementById('delete-button');
let deleteTitle = document.getElementById('deleteTitle');
let deleteId = null;

  //   course-tab data fetching

  let courseFetchDetails = null;
  const getCourseDetails = async (courses) => {
    console.log("In course fetch details");
    const details = courses.map(async (courseName) => {
      const instructorsPromise = await fetch(`${ngshare_url}instructors/${courseName}`);
      const instructorsJson = await instructorsPromise.json();
      const instructorName = instructorsJson.instructors[0].username;
      const studentsPromise = await fetch(`${ngshare_url}students/${courseName}`);
      const studentsJson = await studentsPromise.json();
      const studentsCount = studentsJson.students.length;
      return { 'courseName': courseName, 'trainer': instructorName, 'studentsCount': studentsCount };
    });
    return Promise.all(details);
  }

  function addAndAppendCourse(course) {
    let courseCardId = course.courseName;
    let courseCont = document.createElement('div');
    courseCont.classList.add('courseCard');
    courseCont.id = courseCardId;
    courseCardCont.appendChild(courseCont);

    let courseLeft = document.createElement('div');
    courseLeft.classList.add('course-card-left');
    courseCont.appendChild(courseLeft);

    let courseTitle = document.createElement('p');
    courseTitle.classList.add('course-title');
    courseLeft.appendChild(courseTitle);
    courseTitle.textContent = course.courseName;

    let arrangeRow = document.createElement('div');
    arrangeRow.classList.add('arrange-row');
    courseLeft.appendChild(arrangeRow);

    let arrangeCol = document.createElement('div');
    arrangeCol.classList.add('arrange-col','arrange-col-first');
    arrangeRow.appendChild(arrangeCol);

    let countTitle = document.createElement('span');
    countTitle.classList.add('learner-count-title');
    countTitle.textContent = 'Learner count';
    arrangeCol.appendChild(countTitle);
    let count = document.createElement('span');
    arrangeCol.appendChild(count);
    count.textContent = course.studentsCount;
    count.classList.add('learner-count');

    let arrangeColTrain = document.createElement('div');
    arrangeColTrain.classList.add('arrange-col');
    arrangeRow.appendChild(arrangeColTrain);

    let trainTitle = document.createElement('span');
    trainTitle.classList.add('learner-count-title');
    trainTitle.textContent = 'Trainer name';
    arrangeColTrain.appendChild(trainTitle);
    let trainName = document.createElement('span');
    arrangeColTrain.appendChild(trainName);
    trainName.textContent = course.trainer;
    trainName.classList.add('learner-count');

    let deleteIconCont = document.createElement('div');
    deleteIconCont.onclick = function(){
        deleteCourseModal.style.display='block';
        deleteTitle.textContent = course.courseName;
        deleteId = courseCardId;

      
    }
    deleteIconCont.classList.add('delete-icon');
    let deleteIconI = document.createElement('img');
    deleteIconI.src = 'https://i.postimg.cc/prKj8HZB/delete.png';
    deleteIconCont.appendChild(deleteIconI);
    courseCont.appendChild(deleteIconCont);

}

  (async () => {
    console.log("In sync");
    const courseFetch = await fetch(`${ngshare_url}courses`);
    const courseJson = await courseFetch.json();
    const coursesList = await courseJson.courses;
    courseFetchDetails = await getCourseDetails(coursesList);
    for (let course of courseFetchDetails) {
    addAndAppendCourse(course);
  }
  })();

  console.log(courseFetchDetails);
//   for (let course of courseFetchDetails) {
//     addAndAppendCourse(course);
//   }

const deleteCourse = async (courseName) => {
    const courseDeletePromise = await fetch(`${ngshare_url}course/${courseName}`, {
    method: 'DELETE',
    headers: {
    Accept: 'application.json',
    'Content-Type': 'application/json'
    }
    });
    const response = await courseDeletePromise.json();
        if (response.success) {
    // alert("Successfully deleted course");
    let deleteCard = document.getElementById(courseName);
    courseCardCont.removeChild(deleteCard);
    fetchCourseDetails();
    }
    else {
    alert("Something went wrong! Couldn't delete course");
    }   
}
deleteBtn.onclick = function(){
    
    // deleteCourseModal.style.display = 'none';
    deleteCourse(deleteId);
    deleteCourseModal.style.display = 'none';
}

   

let trainers_ =[
    {
        id:1,
        trainerName :'Sidhartha Chinthapally',
        courseCount : '13',
        status_:'Mapped'
    },
    {
        id:2,
        trainerName :'Sravanthi Peetla',
        courseCount : '18',
        status_:'Mapped'
    },
    {
        id:3,
        trainerName :'Saraswathi Pasumarthi',
        courseCount : '19',
        status_:'Mapped'
    },
    {
        id:4,
        trainerName :'Sidhartha Chinthapally',
        courseCount : '10',
        status_:'Mapped'
    },
    {
        id:5,
        trainerName :'Sravanthi Peetla',
        courseCount : '13',
        status_:'Mapped'
    },
    {
        id:6,
        trainerName :'Sravanthi Peetla',
        courseCount : '12',
        status_:'Mapped'
    },
    {
        id:7,
        trainerName :'Saraswathi Pasumarthi',
        courseCount : '23',
        status_:'Mapped'
    },
]

const getInstructorDetails = async (courses, instructorsUsername) => {
    console.log("In instructor fetch details");
    let instructorCourse = {};
    for(let inst of instructorsUsername){
        instructorCourse[inst] = [];
    }
    courses.map(async (courseName) => {
        const instructorsPromise = await fetch(`${ngshare_url}instructors/${courseName}`);
        const instructorsJson = await instructorsPromise.json();
        const instructorName = instructorsJson.instructors[0].username;
        instructorCourse[instructorName].push(courseName);
    });
    return instructorCourse;
    // let instructorDetails=[];
    // for (key in instructorCourse){
    //     let status = null;
    //     if (instructorCourse[key].length > 0){
    //         status='Mapped';
    //     }
    //     else{
    //         status='Unmapped';
    //     }
    //     instructorDetails.push({'name':key,'course':instructorCourse[key],'status':status});

    // }
    // console.log(instructorDetails);
    // console.log(courseInstructor);
    // console.log(instructorCourse);
//     for (let inst of instructorsUsername ){
//         instructorCourse[inst]=[];
//         for (let key in courseInstructor){
//             for (let key in courseInstructor){
//             console.log("key",key);
//             console.log("inst",inst);
//             if (courseInstructor[key] === inst){
//                 instructorCourse[inst].push(key);
//                 console.log(instructorCourse);
//             }
//         }
//         console.log(courseInstructor);
//         console.log(instructorCourse);
//     }
//     // return Promise.all(details);
//   };

};
let trainerFetchDetails = null;
function addAndAppendTrainer(trainer) {
    let trainerCardId = 'trainerCard' + trainer.id;
    let trainerCont = document.createElement('div');
    trainerCont.classList.add('trainerCard','trainerCard-width');
    trainerCont.id = trainerCardId;
    trainerCardCont.appendChild(trainerCont);

    let trainerLeft = document.createElement('div');
    trainerLeft.classList.add('trainer-card-left');
    trainerCont.appendChild(trainerLeft);

    let trainerTitle = document.createElement('p');
    trainerTitle.classList.add('trainer-title');
    trainerLeft.appendChild(trainerTitle);
    trainerTitle.textContent = trainer.trainerName;

    let arrangeRow = document.createElement('div');
    arrangeRow.classList.add('arrange-row');
    trainerLeft.appendChild(arrangeRow);

    let arrangeCol = document.createElement('div');
    arrangeCol.classList.add('arrange-col');
    arrangeRow.appendChild(arrangeCol);

    let countTitle = document.createElement('span');
    countTitle.classList.add('learner-count-title');
    countTitle.textContent = 'Course count';
    arrangeCol.appendChild(countTitle);
    let count = document.createElement('span');
    arrangeCol.appendChild(count);
    count.textContent = trainer.courseCount;
    count.classList.add('learner-count');

    let arrangeColTrain = document.createElement('div');
    arrangeColTrain.classList.add('arrange-col');
    arrangeRow.appendChild(arrangeColTrain);

    let statusTitle = document.createElement('span');
    statusTitle.classList.add('learner-count-title');
    statusTitle.textContent = 'Status';
    arrangeColTrain.appendChild(statusTitle);
    let statusName = document.createElement('span');
    arrangeColTrain.appendChild(statusName);
    statusName.textContent = trainer.status_;
    statusName.classList.add('learner-count');

    let eyeIconCont = document.createElement('div');
    eyeIconCont.onclick = function(){
        deleteTrainerModal.style.display='block';
        deleteTrainer.textContent = trainer.trainerName;
        // function deleteCourse(){
        //     courses_.splice(course.id,1);

        //      deleteCourseModal.style.display = 'none';
        // }
      
    }
    eyeIconCont.classList.add('eye-icon');
    let eyeIconI = document.createElement('img');
    eyeIconI.src = 'https://i.postimg.cc/KzLzhpXT/eye.png';
    eyeIconCont.appendChild(eyeIconI);
    trainerCont.appendChild(eyeIconCont);

}

    
      (async () => {
        const courseFetch = await fetch(`${ngshare_url}courses`);
        const courseJson = await courseFetch.json();
        const coursesList = courseJson.courses;
        const hubUsersFetch = await fetch(`${hub_url}users`);
        const hubUsersJson = await hubUsersFetch.json();
        const instructorsUsername = [];
    for (let i = 0; i < hubUsersJson.length; i++) {
        if (hubUsersJson[i].groups.includes('instructor')) {
          instructorsUsername.push(hubUsersJson[i].name);
        }
      }
      console.log("instructors list",instructorsUsername);
        trainerFetchDetails = await getInstructorDetails(coursesList, instructorsUsername);
        console.log(trainerFetchDetails);
        let instructorDetails=[];
        for (key in trainerFetchDetails){
        let status = null;
        if (trainerFetchDetails[key].length > 0){
            status='Mapped';
        }
        else if(trainerFetchDetails[key].length === 0) {
            status='Unmapped';
        }
        instructorDetails.push({'name':key,'course':trainerFetchDetails[key],'status':status});
    }
    console.log(instructorDetails);
      })();
      console.log(trainerFetchDetails);
for (let trainer of trainers_) {
    addAndAppendTrainer(trainer);
}

  


    courses.onclick = function () {
    instructorsFilter.classList.add('stop-visible');
    addBtn.textContent = "Add Course";
    description.textContent = "You can manage Course details here.";
    instructor.classList.remove('active');
    courses.classList.add('active');
    learner.classList.remove('active');
    courseDetails.classList.remove('stop-visible');
    trainerDetails.classList.add('stop-visible');
    learnerDetails.classList.add('stop-visible');
  }
  instructor.onclick = function () {
    instructorsFilter.classList.remove('stop-visible');
    addBtn.textContent = "Add Trainer";
    description.textContent = "You can manage Trainer details here.";
    instructor.classList.add('active');
    courses.classList.remove('active');
    learner.classList.remove('active');
    courseDetails.classList.add('stop-visible');
    trainerDetails.classList.remove('stop-visible');
    learnerDetails.classList.add('stop-visible');
  }
  learner.onclick = function () {
    instructorsFilter.classList.add('stop-visible');
    addBtn.textContent = "Add Learners";
    description.textContent = "You can manage Learner details here.";
    instructor.classList.remove('active');
    courses.classList.remove('active');
    learner.classList.add('active');
    courseDetails.classList.add('stop-visible');
    trainerDetails.classList.add('stop-visible');
    learnerDetails.classList.remove('stop-visible');
  }
  
  deleteCancel.onclick = function () {
    deleteCourseModal.style.display = 'none';
  }
  addCourseCancel.onclick = function () {
    addCourseModal.style.display = 'none';
  }
  addBtn.onclick = async function () {
    if (addBtn.textContent === "Add Course" || addBtn.textContent === "Add Trainer") {
        addCourseModal.style.display = 'block';
        modelTitle.textContent = addBtn.textContent;
        const hubUsersFetch = await fetch(`${hub_url}users`);
        const hubUsersJson = await hubUsersFetch.json();
        const instructorsUsername = [];
        for (let i = 0; i < hubUsersJson.length; i++) {
            if (hubUsersJson[i].groups.includes('instructor')) {
            instructorsUsername.push(hubUsersJson[i].name);
            }
        }
        console.log(instructorsUsername);
    }
    else if (addBtn.textContent === "Add Learners") {
      addLearnerModal.style.display = 'block';
    }
  }
  deleteTrainerCancel.onclick = function () {
    deleteTrainerModal.style.display = 'none';
  }
  addLearnerCancel.onclick = function () {
    addLearnerModal.style.display = 'none';
  }
  singleUserBtn.onclick = function () {
    singleUserBtn.classList.add('learner-active');
    multipleUserBtn.classList.remove('learner-active');
    singleLearner.style.display = 'block';
    multipleLearners.style.display = 'none';
  }
  multipleUserBtn.onclick = function () {
    singleUserBtn.classList.remove('learner-active');
    multipleUserBtn.classList.add('learner-active');
    singleLearner.style.display = 'none';
    multipleLearners.style.display = 'block';
  }
</script>
{% endblock %}
